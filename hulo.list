# > hulo.list - Chinese Social Media Rules
# > This ruleset contains rules for Chinese social media platforms
# > Included: Zhihu and Xiaohongshu (RED)
# > Use this ruleset to route traffic through proxy for better performance

# ========================================
# Zhihu - Q&A Community Platform ⭐ IP Control
# ========================================
# China's largest question-and-answer platform
# Purpose: Control IP location display for posts and comments

# > User-Agent Rules
USER-AGENT,*zhihu*
USER-AGENT,zhihu*
USER-AGENT,*ZhihuHybrid*  # Zhihu APP hybrid framework
USER-AGENT,*osee*  # Zhihu internal codename

# > Domain Rules
DOMAIN,api.zhihu.com  # Zhihu API - Critical for APP (must be first!)
DOMAIN-SUFFIX,zhihu.com  # Main domain (includes all subdomains: www, link, etc.)
DOMAIN-SUFFIX,zhimg.com  # Zhihu image CDN (pic1.zhimg.com, pic2.zhimg.com, etc.)
DOMAIN-KEYWORD,zhihu

# > Zhihu IP Ranges - For APP IP Location Display ⭐
# Note: Carefully selected to avoid conflicts with Xiaohongshu

# > Zhihu Main Service IPs (Aliyun Beijing)
IP-CIDR,47.94.0.0/16,no-resolve  # Aliyun Beijing - Zhihu API servers
IP-CIDR,47.95.0.0/16,no-resolve  # Aliyun Beijing - Zhihu web services

# > Zhihu CDN IPs (Aliyun Hangzhou)
IP-CIDR,47.96.0.0/16,no-resolve  # Aliyun Hangzhou zone A
IP-CIDR,47.97.0.0/16,no-resolve  # Aliyun Hangzhou zone B
IP-CIDR,47.98.0.0/16,no-resolve  # Aliyun Hangzhou zone C

# > Zhihu Image CDN (zhimg.com)
IP-CIDR,121.196.0.0/16,no-resolve  # Zhihu image CDN
IP-CIDR,121.199.0.0/16,no-resolve  # Zhihu image CDN backup

# > Zhihu API Servers (Specific)
IP-CIDR,106.75.0.0/16,no-resolve  # Zhihu API backend
IP-CIDR,120.55.0.0/16,no-resolve  # Zhihu API backend backup

# > Zhihu Video CDN
IP-CIDR,121.43.0.0/16,no-resolve  # Zhihu video CDN

# ========================================
# Xiaohongshu - Lifestyle Sharing Platform ⭐ IP Control
# ========================================
# Also known as RED, a lifestyle and social e-commerce platform
# Extended domain rules: Complete API coverage for OpenClash compatibility

# > Domain Rules (Complete API coverage - 12 rules total)
# Core Services (6 rules)
DOMAIN,www.xiaohongshu.com              # Main website
DOMAIN,api.xiaohongshu.com              # Core API - determines IP location
DOMAIN,edith.xiaohongshu.com            # Editor API (for posting)
DOMAIN,edith-seb.xiaohongshu.com        # Editor service backend (publishing pipeline)
DOMAIN,customer.xiaohongshu.com         # Customer service API
DOMAIN,fe-video-qc.xhscdn.com           # Frontend video processing

# Extended Services (6 rules - NEW)
DOMAIN,sns.xiaohongshu.com              # Social functions (following page, fans list)
DOMAIN,ci.xiaohongshu.com               # Content interface (comments, note content)
DOMAIN,referee.xiaohongshu.com          # Recommendation system (home feed)
DOMAIN,user.xiaohongshu.com             # User service (profile pages)
DOMAIN,search.xiaohongshu.com           # Search functionality
DOMAIN,fe-static.xhscdn.com             # Static resources (emojis, icons)

# ⚠️ OPENCLASH-OPTIMIZED STRATEGY:
# 1. NO User-Agent rules - avoid CDN matching
# 2. NO DOMAIN-SUFFIX - avoid CDN interference (xhscdn.com image/video CDN → DIRECT)
# 3. NO IP-CIDR rules - cause severe routing conflicts in OpenClash Redir mode!
# 4. NO shield.xiaohongshu.com - security validation may detect proxy usage
# 5. Only precise DOMAIN rules (12 total) - most stable in double-proxy setup
#
# Function Coverage:
# ✅ Home feed → referee.xiaohongshu.com
# ✅ Following page → sns.xiaohongshu.com
# ✅ Profile pages → user.xiaohongshu.com
# ✅ Note detail → ci.xiaohongshu.com
# ✅ Comments → ci.xiaohongshu.com
# ✅ Emojis → fe-static.xhscdn.com
# ✅ Posting → edith.xiaohongshu.com + edith-seb.xiaohongshu.com
#
# Why NO IP rules in OpenClash?
# - OpenClash (router iptables) + Surge (device) = double NAT conflict
# - IP-CIDR rules trigger routing loops in Redir mode
# - Domain-only routing avoids kernel-layer conflicts

# ========================================
# > Xiaohongshu IP Ranges - For APP IP Location Stability ⭐
# ========================================
# Note: Selected core IP segments to prevent "IP drop" in persistent connections
# Purpose: Ensure proxy IP remains stable during posting/commenting sessions
#
# Why IP rules are needed:
# - Xiaohongshu APP uses long-lived HTTP/2 connections
# - Domain-only rules trigger at DNS resolution (connection start)
# - After connection established, domain rules may not re-evaluate
# - IP rules work at network layer, match every packet (including existing connections)
#
# Strategy: Use /16 segments (same width as Zhihu) for maximum stability

# > Xiaohongshu Core Service IPs (Aliyun + Tencent Cloud)
IP-CIDR,101.132.0.0/16,no-resolve   # Aliyun Shanghai - XHS main API servers
IP-CIDR,106.52.0.0/16,no-resolve    # Tencent Cloud Beijing - XHS API backend
IP-CIDR,117.184.0.0/16,no-resolve   # XHS core services (publish/comment/feed)
IP-CIDR,183.131.0.0/16,no-resolve   # XHS mobile APP API endpoints

# Total coverage: ~262K IPs (4 × /16 segments)
# Trade-off: Wider coverage vs stability (prioritize stability for clean WiFi usage)
